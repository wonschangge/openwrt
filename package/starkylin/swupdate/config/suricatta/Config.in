# SPDX-FileCopyrightText: 2016 Christian Storm <christian.storm@tngtech.com>
#
# SPDX-License-Identifier: GPL-2.0-only

menuconfig SWUPDATE_SURICATTA
	bool "Suricatta"
	depends on SWUPDATE_HAVE_LIBCURL
	select SWUPDATE_CHANNEL_CURL
	help
	  Suricatta is a daemon mode of SWUpdate.

	  Suricatta regularly polls a remote server for updates,
	  downloads, and installs them. Thereafter, it reboots the
	  system and reports the update status to the server, based
	  on an update state variable currently stored in bootloader’s
	  environment ensuring persistent storage across reboots. Some
	  U-Boot script logics or U-Boot’s bootcount feature may be
	  utilized to alter this update state variable, e.g., by
	  setting it to reflect failure in case booting the newly
	  flashed root file system has failed and a switchback had to
	  be performed.

if SWUPDATE_SURICATTA

menu "Features"

config SWUPDATE_SURICATTA_SSL
	bool "SSL support"
	default n
	depends on SWUPDATE_SSL_IMPL_OPENSSL || SWUPDATE_SSL_IMPL_WOLFSSL || SWUPDATE_SSL_IMPL_MBEDTLS
	select SWUPDATE_CHANNEL_CURL_SSL
	help
	  Enable SSL and checksum verification support in suricatta.

comment "SSL support needs an SSL implementation"
	depends on !(SWUPDATE_SSL_IMPL_OPENSSL || SWUPDATE_SSL_IMPL_WOLFSSL || SWUPDATE_SSL_IMPL_MBEDTLS)

endmenu

menu "Server"

config SWUPDATE_SURICATTA_HAWKBIT
	bool "hawkBit support"
	default y
	help
	  Support for hawkBit server.
	  https://projects.eclipse.org/projects/iot.hawkbit

config SWUPDATE_SURICATTA_LUA
	bool "Suricatta Lua module"
	depends on SWUPDATE_HAVE_LUA
	select SWUPDATE_CHANNEL_CURL
	select SWUPDATE_LUA
	help
	  Support for Suricatta modules in Lua.

	  The JSON support for Suricatta Lua modules
	  provides JSON as Lua Tables to the Lua realm and
	  enables channel result parsing to JSON per default.
	  To enable, select 'libjson' in 'Parser Features'.

config SWUPDATE_SURICATTA_WFX
	bool "wfx support"
	depends on SWUPDATE_SURICATTA_LUA
	select SWUPDATE_EMBEDDED_SURICATTA_LUA
	help
	  Support for wfx server.
	  https://www.github.com/siemens/wfx

config SWUPDATE_EMBEDDED_SURICATTA_LUA
	bool "Embed Suricatta Lua module in SWUpdate binary"
	depends on SWUPDATE_SURICATTA_LUA
	help
	  Embed the Suricatta Lua module source code file into
	  the SWUpdate binary.

	  If enabled, a swupdate_suricatta.lua will *not*
	  be loaded from disk at SWUpdate startup.

	  Note: Exactly one Lua source code file is embedded
	  into the binary, i.e., possible dependencies either
	  have to be deployed on the target system or put into
	  the one embedded Lua source code file.

config SWUPDATE_EMBEDDED_SURICATTA_LUA_SOURCE
	string "Suricatta Lua module file"
	depends on SWUPDATE_EMBEDDED_SURICATTA_LUA
	default "swupdate_suricatta.lua" if !SWUPDATE_SURICATTA_WFX
	default "suricatta/server_wfx.lua" if SWUPDATE_SURICATTA_WFX
	help
	  Path to the Suricatta Lua module source code file to
	  be embedded into the SWUpdate binary.

config SWUPDATE_SURICATTA_GENERAL
	bool "General HTTP support"
	help
	  Support for Simple HTTP coded server
	  The server uses HTTP return codes to detect if an update
	  is available. See documentation for more details.

endmenu

comment "Suricatta Lua module support needs Lua"
	depends on !SWUPDATE_HAVE_LUA

comment "Suricatta daemon support needs libcurl"
	depends on !SWUPDATE_HAVE_LIBCURL

endif
